(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keyup",o)}function n(e){e.classList.add("popup_opened"),document.addEventListener("keyup",o)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}e.d({},{k:()=>r}),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(n){(n.target.classList.contains("popup")||n.target.classList.contains("popup__close-button"))&&t(e)}))}));var r,c={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-4",headers:{authorization:"793bf34e-3e6e-4058-885b-b4d769d3c305","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},u=document.querySelector(".popup_type_picture"),i=u.querySelector(".popup__picture"),l=u.querySelector(".popup__caption"),s=document.querySelector(".elements__container"),d=document.querySelector("#element").content,p=function(e){var t=d.querySelector(".element").cloneNode(!0);t.querySelector(".element__caption").textContent=e.name;var o=t.querySelector(".element__trash");o.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(c.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:c.headers}).then(a)).then((function(){o.closest(".element").remove()})).catch((function(e){return console.log("Ошибка: ".concat(e))}))})),e.owner._id!==r&&o.remove(),e.likes.forEach((function(e){e._id===r&&t.querySelector(".element__like").classList.add("element__like_active")}));var s=t.querySelector(".element__like");s.addEventListener("click",(function(){var t;s.classList.contains("element__like_active")?(t=e._id,fetch("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:c.headers}).then(a)).then((function(e){f.textContent="".concat(e.likes.length),s.classList.remove("element__like_active")})).catch((function(e){return console.log("Ошибка: ".concat(e))})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(a)}(e._id).then((function(e){f.textContent="".concat(e.likes.length),s.classList.add("element__like_active")})).catch((function(e){return console.log("Ошибка: ".concat(e))}))}));var p=t.querySelector(".element__image");p.addEventListener("click",(function(){n(u),i.src=p.src,l.textContent=p.alt,i.alt=p.alt}));var f=t.querySelector(".element__like-counter");f.textContent="".concat(e.likes.length);var m=t.querySelector(".element__image");return m.src=e.link,m.alt=e.name,t},f=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass),o.textContent=""},m=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))},_=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(n){f(e,n,t)}));var o=e.querySelector(t.submitButtonSelector);m(n,o,t)},v=document.querySelector(".profile__name"),h=document.querySelector(".profile__status"),y=document.querySelector(".profile__avatar"),S=document.querySelector(".popup_type_profile-editing"),b=document.forms.profileInfo,q=b.elements.name,L=b.elements.status,E=document.querySelector(".popup_type_add-card"),k=document.forms.addCard,C=k.elements.cardName,g=k.elements.cardLink,x=document.querySelector(".popup_type_avatar"),A=document.forms.avatarEdit,U=A.elements.avatarLink,P=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button"),T=document.querySelector(".profile__avatar-edit-button"),B=S.querySelector(".popup__save-button"),j=E.querySelector(".popup__save-button"),D=x.querySelector(".popup__save-button"),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};Promise.all([fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then(a)]).then((function(e){v.textContent=e[0].name,h.textContent=e[0].about,y.src=e[0].avatar,r=e[0]._id,e[1].forEach((function(e){var t;t=e,s.append(p(t))}))})).catch((function(e){return console.log("Ошибка: ".concat(e))})),P.addEventListener("click",(function(){n(S),q.value=v.textContent,L.value=h.textContent,_(S,N)}));var w,J=function(e,t,n){t.textContent=e?"Сохранение...":n};O.addEventListener("click",(function(){n(E),k.reset(),_(E,N)})),T.addEventListener("click",(function(){n(x),A.reset(),_(x,N)})),b.addEventListener("submit",(function(e){var n,o;e.preventDefault(),J(!0,B,"Сохранить"),(n=q.value,o=L.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:n,about:o})}).then(a).catch((function(e){return console.log("Ошибка: ".concat(e))}))).then((function(e){v.textContent=e.name,h.textContent=e.about,t(S)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return J(!1,B,"Сохранить")}))})),k.addEventListener("submit",(function(e){var n,o;e.preventDefault(),J(!0,j,"Создать"),(n=C.value,o=g.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:n,link:o})}).then(a).catch((function(e){return console.log("Ошибка: ".concat(e))}))).then((function(e){var n;n=e,s.prepend(p(n)),t(E)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return J(!1,j,"Создать")}))})),A.addEventListener("submit",(function(e){var n;e.preventDefault(),J(!0,D,"Сохранить"),(n=U.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:n})}).then(a).catch((function(e){return console.log("Ошибка: ".concat(e))}))).then((function(e){y.src=e.avatar,t(x)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return J(!1,D,"Сохранить")}))})),w=N,Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?f(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}(e,t,t.validationMessage,n)}(e,r,t),m(n,o,t)}))}))}(e,w)}))})();