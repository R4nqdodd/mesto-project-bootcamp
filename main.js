(()=>{"use strict";function e(e){e.classList.remove("popup_opened"),document.removeEventListener("keyup",n)}function t(e){e.classList.add("popup_opened"),document.addEventListener("keyup",n)}function n(t){"Escape"===t.key&&e(document.querySelector(".popup_opened"))}Array.from(document.querySelectorAll(".popup")).forEach((function(t){t.addEventListener("click",(function(n){(n.target.classList.contains("popup")||n.target.classList.contains("popup__close-button"))&&e(t)}))}));var o,r,c,a={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-4",headers:{authorization:"793bf34e-3e6e-4058-885b-b4d769d3c305","Content-Type":"application/json"}},s=document.querySelector(".popup_type_picture"),u=s.querySelector(".popup__picture"),i=s.querySelector(".popup__caption"),l=document.querySelector(".elements__container"),d=document.querySelector("#element").content,p=function(e){var n=d.querySelector(".element").cloneNode(!0);n.querySelector(".element__caption").textContent=e.name,fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e.owner._id===t._id&&f(n),e.likes.forEach((function(e){e._id===t._id&&n.querySelector(".element__like").classList.add("element__like_active")}))})).catch((function(e){return console.log("Ошибка: ".concat(e))})),n.addEventListener("click",(function(n){var r;n.target.classList.contains("element__like")&&(n.target.classList.contains("element__like_active")?(r=e._id,fetch("".concat(a.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){o.textContent="".concat(e.likes.length)})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e._id).then((function(e){o.textContent="".concat(e.likes.length)})),n.target.classList.toggle("element__like_active")),n.target.classList.contains("element__trash")&&(function(e){fetch("".concat(a.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e._id),n.target.closest(".element").remove()),n.target.classList.contains("element__image")&&(t(s),u.src=n.target.src,i.textContent=n.target.alt,u.alt=n.target.alt)}));var o=n.querySelector(".element__like-counter");o.textContent="".concat(e.likes.length);var r=n.querySelector(".element__image");return r.src=e.link,r.alt=e.name,n},f=function(e){var t=document.createElement("button");t.setAttribute("type","button"),t.setAttribute("aria-label","Удалить карточку"),t.classList.add("element__trash"),e.prepend(t)},m=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass),o.textContent=""},_=function(e){return e.some((function(e){return!e.validity.valid}))},v=function(e,t,n){_(e)?(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled"))},h=function(e,t){var n=Array.from(e.querySelectorAll(".popup__input"));n.forEach((function(n){m(e,n,t)}));var o=e.querySelector(".popup__save-button");_(n)?(o.setAttribute("disabled",!0),o.classList.add(t.inactiveButtonClass)):(o.removeAttribute("disabled"),o.classList.remove(t.inactiveButtonClass))},y=document.querySelector(".profile__name"),b=document.querySelector(".profile__status"),S=document.querySelector(".profile__avatar"),L=document.querySelector(".popup_type_profile-editing"),k=document.forms.profileInfo,q=k.elements.name,g=k.elements.status,C=document.querySelector(".popup_type_add-card"),E=document.forms.addCard,A=E.elements.cardName,j=E.elements.cardLink,x=document.querySelector(".popup_type_avatar"),P=document.forms.avatarEdit,U=P.elements.avatarLink,B=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),D=document.querySelector(".profile__avatar-edit-button"),N=L.querySelector(".popup__save-button"),O=C.querySelector(".popup__save-button"),J=x.querySelector(".popup__save-button"),w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};(o=y,r=b,c=S,fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){o.textContent=e.name,r.textContent=e.about,c.src=e.avatar}))).catch((function(e){return console.log("Ошибка: ".concat(e))})),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t;t=e,l.append(p(t))}))})).catch((function(e){return console.log("Ошибка: ".concat(e))})),B.addEventListener("click",(function(){t(L),q.value=y.textContent,g.value=b.textContent,h(L,w)}));var H,z=function(e,t,n){t.textContent=e?"Сохранение...":n};T.addEventListener("click",(function(){t(C),E.reset(),h(C,w)})),D.addEventListener("click",(function(){t(x),P.reset(),h(x,w)})),k.addEventListener("submit",(function(t){t.preventDefault(),z(!0,N,"Сохранить"),y.textContent=q.value,b.textContent=g.value,function(e,t){return fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})})}(q.value,g.value).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return z(!1,N,"Сохранить")})),e(L)})),E.addEventListener("submit",(function(t){var n,o;t.preventDefault(),z(!0,O,"Создать"),(n=A.value,o=j.value,fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t;t=e,l.prepend(p(t))})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return z(!1,O,"Создать")})),e(C)})),P.addEventListener("submit",(function(t){t.preventDefault(),z(!0,J,"Сохранить"),S.src=U.value,function(e){return fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})})}(U.value).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return z(!1,J,"Сохранить")})),e(x)})),H=w,Array.from(document.querySelectorAll(H.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);v(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?m(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}(e,t,t.validationMessage,n)}(e,r,t),v(n,o,t)}))}))}(e,H)}))})();